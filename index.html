<!DOCTYPE html>
<html lang="en">
<head>
  <title>Visualisasi Data</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/billboard.js/1.5.1/billboard.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <!-- D3 JS -->
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
  <script src="https://d3js.org/d3-fetch.v1.min.js"></script>

  <!-- Load billboard.js with style -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/billboard.js/1.5.1/billboard.js"></script>  
  
  <!-- Highchart -->
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/highcharts-3d.js"></script>
  <script src="https://code.highcharts.com/modules/series-label.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://code.highcharts.com/modules/accessibility.js"></script>
  <script src="https://code.highcharts.com/highcharts-more.js"></script>
  <!-- Highchart -->
  
</head>
<body>

<div class="text-center">
    <div class="card bg-dark text-white">
        <div class="card-body">
            <h4 class="card-title">Visualisasi Data dari File CSV</h4>
        </div>
      </div>
  
  <!-- <p>Resize this responsive page to see the effect!</p>  -->
</div>
 <br> 
<div class="container">
  <div class="row">
    <div class="col-sm-6">
      <div id="container1"></div>
     
    </div>
    <div class="col-sm-6">
      <div id="container2"></div>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-6">
      <div id="container3"></div>
     
    </div>
    <div class="col-sm-6">
      <div id="container4"></div>
    </div>
  </div>
</div>
<script>
   
    
    // a = ["1","1","1","1","2","3","4","5","6","1","2","3"]
    // b = uniqBy(a, JSON.stringify)
    // console.log(b)
    var country = []
    var dataku = []
    d3.request("https://raw.githubusercontent.com/jumadilakbar/viusualisasi-data/master/data/mock.csv")
        .mimeType("text/csv")
        .response(function (xhr) { return d3.csvParse(xhr.responseText); })
        .get(function(data) {
            // console.log(data);
            poland = 0;
            russia = 0;
            german = 0;
            uk = 0;
            usa = 0;

            part_poland = [];
            part_russia = [];
            part_german = [];
            part_uk = [];
            part_usa = [];

            study1 = [];
            study2 = [];
            study3 = [];
            study4 = [];
            study5 = [];
            std1_pl = 0;
            std1_rs = 0;
            std1_gr = 0;
            std1_uk = 0;
            std1_usa = 0;
            std2_pl = 0;
            std2_rs = 0;
            std2_gr = 0;
            std2_uk = 0;
            std2_usa = 0;
            std3_pl = 0;
            std3_rs = 0;
            std3_gr = 0;
            std3_uk = 0;
            std3_usa = 0;
            std4_pl = 0;
            std4_rs = 0;
            std4_gr = 0;
            std4_uk = 0;
            std4_usa = 0;
            std5_pl = 0;
            std5_rs = 0;
            std5_gr = 0;
            std5_uk = 0;
            std5_usa = 0;
            for (let index = 0; index < data.length; index++) {
                // console.log(data[index].country);
                // a = data[index].country
                if (data[index].country=='poland') {
                    poland++;
                    part_poland.push({
                        name: data[index].participant_name,
                        value: 1,
                    } );
                }
                else if (data[index].country=='russia') {
                    russia++;
                    part_russia.push({
                        name: data[index].participant_name,
                        value: 1,
                    } );
                }
                else if (data[index].country=='german') {
                    german++;
                    part_german.push({
                        name: data[index].participant_name,
                        value: 1,
                    } );
                }
                else if (data[index].country=='uk') {
                    uk++;
                    part_uk.push({
                        name: data[index].participant_name,
                        value: 1,
                    } );
                }
                else if (data[index].country=='usa') {
                    usa++;
                    part_usa.push({
                        name: data[index].participant_name,
                        value: 1,
                    } );
                }
                // filter BY study
                if (data[index].study_id=='study1') {
                    study1++;
                    if (data[index].country=='poland') {
                        std1_pl++;
                    }
                    else if (data[index].country=='russia') {
                        std1_rs++;
                    }
                    else if (data[index].country=='german') {
                        std1_gr++;
                    }
                    else if (data[index].country=='uk') {
                        std1_uk++;
                    }
                    else if (data[index].country=='usa') {
                        std1_usa++;
                    }
                }
                else if (data[index].study_id=='study2') {
                    study2++;
                    if (data[index].country=='poland') {
                        std2_pl++;
                    }
                    else if (data[index].country=='russia') {
                        std2_rs++;
                    }
                    else if (data[index].country=='german') {
                        std2_gr++;
                    }
                    else if (data[index].country=='uk') {
                        std2_uk++;
                    }
                    else if (data[index].country=='usa') {
                        std2_usa++;
                    }
                }
                else if (data[index].study_id=='study3') {
                    study3++;
                    if (data[index].country=='poland') {
                        std3_pl++;
                    }
                    else if (data[index].country=='russia') {
                        std3_rs++;
                    }
                    else if (data[index].country=='german') {
                        std3_gr++;
                    }
                    else if (data[index].country=='uk') {
                        std3_uk++;
                    }
                    else if (data[index].country=='usa') {
                        std3_usa++;
                    }
                }
                else if (data[index].study_id=='study4') {
                    study4++;
                    if (data[index].country=='poland') {
                        std4_pl++;
                    }
                    else if (data[index].country=='russia') {
                        std4_rs++;
                    }
                    else if (data[index].country=='german') {
                        std4_gr++;
                    }
                    else if (data[index].country=='uk') {
                        std4_uk++;
                    }
                    else if (data[index].country=='usa') {
                        std4_usa++;
                    }
                }
                else if (data[index].study_id=='study5') {
                    study5++;
                    if (data[index].country=='poland') {
                        std5_pl++;
                    }
                    else if (data[index].country=='russia') {
                        std5_rs++;
                    }
                    else if (data[index].country=='german') {
                        std5_gr++;
                    }
                    else if (data[index].country=='uk') {
                        std5_uk++;
                    }
                    else if (data[index].country=='usa') {
                        std5_usa++;
                    }
                }
                
                
            }
            // dataku.push(data)
            // Data By Country
            // Radialize the colors
            Highcharts.setOptions({
                colors: Highcharts.map(Highcharts.getOptions().colors, function (color) {
                    return {
                        radialGradient: {
                            cx: 0.5,
                            cy: 0.3,
                            r: 0.7
                        },
                        stops: [
                            [0, color],
                            [1, Highcharts.color(color).brighten(-0.3).get('rgb')] // darken
                        ]
                    };
                })
            });

            // Build the chart
            Highcharts.chart('container1', {
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie'
                },
                title: {
                    text: 'Pesentase Data By Country'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                accessibility: {
                    point: {
                        valueSuffix: '%'
                    }
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            connectorColor: 'silver'
                        }
                    }
                },
                series: [{
                    name: 'Share',
                    data: [
                        { name: 'Poland', y: poland },
                        { name: 'Russia', y: russia },
                        { name: 'German', y: german },
                        { name: 'USA', y: usa },
                        { name: 'UK', y: uk }
                    ]
                }]
            });
            // dataku = data
            // Data2
            Highcharts.chart('container2', {
            chart: {
                type: 'packedbubble',
                height: '100%'
            },
            title: {
                text: 'Partisipan from country'
            },
            tooltip: {
                useHTML: true,
                pointFormat: '<b>{point.name}:</b> {point.value}person<sub></sub>'
            },
            plotOptions: {
                packedbubble: {
                    minSize: '20%',
                    maxSize: '100%',
                    zMin: 0,
                    zMax: 1000,
                    layoutAlgorithm: {
                        gravitationalConstant: 0.05,
                        splitSeries: true,
                        seriesInteraction: false,
                        dragBetweenSeries: true,
                        parentNodeLimit: true
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.name}',
                        filter: {
                            property: 'y',
                            operator: '>',
                            value: 250
                        },
                        style: {
                            color: 'black',
                            textOutline: 'none',
                            fontWeight: 'normal'
                        }
                    }
                }
            },
            series: [{
                name: 'Poland',
                data: part_poland
            }, {
                name: 'German',
                data: part_poland
             }, {
                name: 'Russia',
                data: part_russia
            }, {
                name: 'USA',
                data: part_usa
            }, {
                name: 'UK',
                data: part_uk
            }
        ]
        });
        // Data3
        Highcharts.chart('container3', {
        chart: {
            type: 'pie',
            options3d: {
                enabled: true,
                alpha: 45,
                beta: 0
            }
        },
        title: {
            text: 'Persentase Data Studi BY ID'
        },
        accessibility: {
            point: {
                valueSuffix: '%'
            }
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                depth: 35,
                dataLabels: {
                    enabled: true,
                    format: '{point.name}'
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Part study',
            data: [
                ['Study 1', study1],
                ['Study 2', study2],
                ['Study 3', study3],
                ['Study 4', study4],
                ['Study 5', study5]
            ]
        }]
    });

    // Data 4
    Highcharts.chart('container4', {
    chart: {
        type: 'spline'
    },
    title: {
        text: 'Filter Data By Study From Country'
    },

    subtitle: {
        text: 'Source: File CSV'
    },

    yAxis: {
        title: {
            text: 'Number of Employees'
        }
    },

    xAxis: {
        // accessibility: {
        //     rangeDescription: 'Range: 2010 to 2017'
        // }
        categories: ['Poland', 'Russia', 'German', 'UK', 'USA']
    },

    legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle'
    },
    plotOptions: {
        spline: {
            marker: {
                radius: 4,
                lineColor: '#666666',
                lineWidth: 1
            }
        }
    },

    // plotOptions: {
    //     series: {
    //         label: {
    //             connectorAllowed: false
    //         },
    //         pointStart: 2010
    //     }
    // },

    series: [{
        name: 'Study 1',
        data: [std1_pl,std1_rs,std2_gr,std1_uk,std1_usa]
    }, {
        name: 'Study 2',
        data: [std2_pl,std2_rs,std2_gr,std2_uk,std2_usa]
    }, {
        name: 'Study 3',
        data: [std3_pl,std3_rs,std3_gr,std3_uk,std3_usa]
    }, {
        name: 'Study 4',
        data: [std4_pl,std4_rs,std4_gr,std4_uk,std4_usa]
    }, {
        name: 'Study 5',
        data: [std5_pl,std5_rs,std5_gr,std5_uk,std5_usa]
    }],

    responsive: {
        rules: [{
            condition: {
                maxWidth: 500
            },
            chartOptions: {
                legend: {
                    layout: 'horizontal',
                    align: 'center',
                    verticalAlign: 'bottom'
                }
            }
        }]
    }

    });


    Highcharts.chart('container5', {
        chart: {
            type: 'spline'
        },
        title: {
            text: 'Monthly Average Temperature'
        },
        subtitle: {
            text: 'Source: WorldClimate.com'
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
        },
        yAxis: {
            title: {
                text: 'Temperature'
            },
            labels: {
                formatter: function () {
                    return this.value + '°';
                }
            }
        },
        tooltip: {
            crosshairs: true,
            shared: true
        },
        plotOptions: {
            spline: {
                marker: {
                    radius: 4,
                    lineColor: '#666666',
                    lineWidth: 1
                }
            }
        },
        series: [{
            name: 'Tokyo',
            marker: {
                symbol: 'square'
            },
            data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, {
                y: 26.5,
                marker: {
                    symbol: 'url(https://www.highcharts.com/samples/graphics/sun.png)'
                }
            }, 23.3, 18.3, 13.9, 9.6]

        }, {
            name: 'London',
            marker: {
                symbol: 'diamond'
            },
            data: [{
                y: 3.9,
                marker: {
                    symbol: 'url(https://www.highcharts.com/samples/graphics/snow.png)'
                }
            }, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
        }]
    });

    });
   
    
</script>

</body>
</html>
